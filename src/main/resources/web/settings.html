<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Einstellungen - Syldoria Launcher</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-color: #00FF66;
      --primary-dark: #00CF55;
      --secondary-color: #121212;
      --dark-bg: #070707;
      --card-bg: #0F0F0F;
      --text-color: #FFFFFF;
      --text-secondary: #8A8A8A;
      --error-color: #FF4747;
      --heart-color: #FF3366;
      --border-color: rgba(255, 255, 255, 0.08);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
      transition: background-color 0.2s ease, opacity 0.2s ease;
    }
    
    body {
      background-color: var(--dark-bg);
      font-family: 'Inter', sans-serif;
      color: var(--text-color);
      width: 900px;
      height: 680px;
      overflow: hidden;
    }
    
    .container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      animation: fadeIn 0.3s ease;
    }
    
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 25px 30px;
      background-color: var(--dark-bg);
      border-bottom: 1px solid var(--border-color);
    }
    
    .logo {
      display: flex;
      align-items: center;
    }
    
    .logo img {
      height: 32px;
      width: auto;
    }
    
    .logo h1 {
      font-size: 1.5rem;
      font-weight: 500;
      margin-left: 12px;
      letter-spacing: -0.5px;
    }
    
    .page-title {
      font-size: 1.8rem;
      font-weight: 600;
      letter-spacing: -0.5px;
      margin-bottom: 18px;
    }
    
    .main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px 30px;
      background-color: var(--dark-bg);
      overflow: hidden; /* Verhindern von Scrollen */
      max-height: 510px; /* Sorgt dafür, dass alles im Fenster bleibt */
    }
    
    .settings-container {
      width: 100%;
      max-width: 720px;
      display: flex;
      flex-direction: column;
    }
    
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 25px;
    }
    
    .settings-card {
      background-color: var(--card-bg);
      border-radius: 8px;
      padding: 20px;
      border: 1px solid var(--border-color);
    }
    
    .settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .settings-item:last-child {
      margin-bottom: 0;
      border-bottom: none;
    }
    
    .settings-item-info h3 {
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .settings-item-info p {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    
    #ramInfo {
      padding: 10px 16px;
      border-radius: 6px;
      background-color: rgba(0, 255, 102, 0.05);
      border: 1px solid rgba(0, 255, 102, 0.1);
      color: var(--text-color);
      font-size: 0.9rem;
      width: 120px;
      text-align: center;
    }
    
    /* Checkbox styling */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.1);
      transition: .2s;
      border-radius: 26px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .2s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--primary-color);
    }
    
    input:checked + .slider:before {
      transform: translateX(24px);
    }
    
    /* Language select */
    .language-select {
      padding: 8px 12px;
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-family: 'Inter', sans-serif;
      width: 120px;
      outline: none;
      cursor: pointer;
    }
    
    .language-select:focus {
      border-color: var(--primary-color);
    }
    
    .language-select option {
      background-color: var(--card-bg);
      color: var(--text-color);
    }
    
    /* Button styling */
    .action-buttons {
      margin-top: 15px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 13px;
    }
    
    button {
      background-color: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-color);
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      font-family: 'Inter', sans-serif;
      transition: all 0.2s ease;
    }
    
    button:hover {
      background-color: rgba(0, 255, 102, 0.05);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    #logoutButton {
      background-color: rgba(255, 71, 71, 0.1);
      border-color: rgba(255, 71, 71, 0.2);
      color: var(--error-color);
    }
    
    #logoutButton:hover {
      background-color: rgba(255, 71, 71, 0.15);
      border-color: var(--error-color);
    }
    
    .back-button-container {
      margin-top: 13px;
    }
    
    #backButton {
      width: 100%;
      padding: 12px;
      background-color: var(--primary-color);
      color: #000000;
      border: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    #backButton:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 255, 102, 0.2);
    }
    
    #backButton:active {
      transform: translateY(0);
      box-shadow: none;
    }
    
    .footer {
      padding: 20px 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.85rem;
      color: var(--text-secondary);
      border-top: 1px solid var(--border-color);
    }
    
    .heart {
      color: var(--heart-color);
      display: inline-block;
      margin: 0 4px;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    /* Notifications */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 6px;
      color: white;
      font-weight: 500;
      font-size: 0.9rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transform: translateX(120%);
      transition: transform 0.3s ease-out;
      z-index: 9999;
      display: flex;
      align-items: center;
      background-color: var(--card-bg);
      border: 1px solid var(--border-color);
      max-width: 300px;
    }
    
    .notification.success {
      background-color: rgba(0, 255, 102, 0.15);
      color: var(--primary-color);
      border-color: rgba(0, 255, 102, 0.2);
    }
    
    .notification.error {
      background-color: rgba(255, 71, 71, 0.15);
      color: var(--error-color);
      border-color: rgba(255, 71, 71, 0.2);
    }
    
    .notification.show {
      transform: translateY(0);
    }
    
    .notification::before {
      content: '';
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: var(--text-color);
      margin-right: 10px;
      flex-shrink: 0;
    }
    
    .notification.success::before {
      background-color: var(--primary-color);
    }
    
    .notification.error::before {
      background-color: var(--error-color);
    }
    
    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(7, 7, 7, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
    }
    
    .loading-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 2px solid rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Modal for log display */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(7, 7, 7, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
    }
    
    .modal.show {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background-color: var(--card-bg);
      width: 90%;
      max-width: 720px;
      max-height: 80vh;
      border-radius: 8px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border-color);
      animation: modalSlideIn 0.3s ease;
    }
    
    @keyframes modalSlideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 1.1rem;
      font-weight: 500;
    }
    
    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px;
      min-width: auto;
      box-shadow: none;
      line-height: 1;
    }
    
    .modal-close:hover {
      color: var(--text-color);
    }
    
    .modal-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }
    
    .log-content {
      font-family: 'Courier New', monospace;
      background-color: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 6px;
      white-space: pre-wrap;
      line-height: 1.5;
      font-size: 0.85rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      color: var(--text-color);
      max-height: 60vh;
      overflow-y: auto;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .slide-up {
      animation: slideUp 0.4s ease forwards;
    }
  </style>
</head>
<body oncontextmenu="return false;">
  <!-- Notification container -->
  <div id="notification" class="notification"></div>
  
  <!-- Loading overlay -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
  </div>
  
  <!-- Log modal -->
  <div id="logModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="logModalTitle">Launcher Log</div>
        <button class="modal-close" id="closeModal">×</button>
      </div>
      <div class="modal-body">
        <div class="log-content" id="logContent">
          Log wird geladen...
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <header class="header">
      <div class="logo">
        <img src="https://cdn.discordapp.com/attachments/1168240906479091843/1333886174636413020/icon.png" alt="Syldoria Logo">
        <h1>Syldoria</h1>
      </div>
    </header>
    
    <main class="main">
      <div class="settings-container">
        <h2 class="page-title" id="settingsTitle">Einstellungen</h2>
        
        <div class="settings-grid slide-up" style="animation-delay: 0.1s;">
          <div class="settings-card">
            <div class="settings-item">
              <div class="settings-item-info">
                <h3 id="ramTitle">Speicher</h3>
                <p id="ramSubtitle">Zugewiesener RAM für dein magisches Abenteuer</p>
              </div>
              <div id="ramInfo">4 GB</div>
            </div>
            
            <div class="settings-item">
              <div class="settings-item-info">
                <h3 id="consoleTitle">Konsole anzeigen</h3>
                <p id="consoleSubtitle">Zeige magische Zauberformeln und Debug-Informationen</p>
              </div>
              <label class="switch">
                <input type="checkbox" id="consoleCheckbox">
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="settings-item">
              <div class="settings-item-info">
                <h3 id="languageTitle">Sprache</h3>
                <p id="languageSubtitle">Wähle deine bevorzugte Sprache</p>
              </div>
              <select id="languageSelect" class="language-select">
                <option value="de">Deutsch</option>
                <option value="en">English</option>
              </select>
            </div>
            
            <div class="settings-item" id="adminSettingsItem" style="display:none;">
              <div class="settings-item-info">
                <h3 id="adminTitle">Admin-Funktionen</h3>
                <p id="adminSubtitle">Erweiterte Magie für Gildenmeister und Administratoren</p>
              </div>
              <button id="adminButton">Admin</button>
            </div>
          </div>
        </div>
        
        <div class="action-buttons slide-up" style="animation-delay: 0.2s;">
          <button id="showLogButton">Log anzeigen</button>
          <button id="logoutButton">Logout</button>
        </div>
        
        <div class="back-button-container slide-up" style="animation-delay: 0.3s;">
          <button id="backButton">Zurück zum Launcher</button>
        </div>
      </div>
    </main>
    
    <footer class="footer">
      <div>Syldoria Launcher • Made with <span class="heart">♥</span> • &copy; 2025</div>
    </footer>
  </div>

  <script>
    // Prevent right-click menu
    document.addEventListener('contextmenu', event => event.preventDefault());
    
    // Language data
    const translations = {
      de: {
        settings: "Einstellungen",
        ram: "Speicher",
        ramDesc: "Zugewiesener RAM für dein magisches Abenteuer",
        console: "Konsole anzeigen",
        consoleDesc: "Zeige magische Zauberformeln und Debug-Informationen",
        language: "Sprache",
        languageDesc: "Wähle deine bevorzugte Sprache",
        admin: "Admin-Funktionen",
        adminDesc: "Erweiterte Magie für Gildenmeister und Administratoren",
        showLog: "Log anzeigen",
        logout: "Logout",
        backToLauncher: "Zurück zum Launcher",
        logModalTitle: "Launcher Log"
      },
      en: {
        settings: "Settings",
        ram: "Memory",
        ramDesc: "Allocated RAM for your magical adventure",
        console: "Show Console",
        consoleDesc: "Show magical spells and debug information",
        language: "Language",
        languageDesc: "Choose your preferred language",
        admin: "Admin Functions",
        adminDesc: "Advanced magic for guild masters and administrators",
        showLog: "Show Log",
        logout: "Logout",
        backToLauncher: "Back to Launcher",
        logModalTitle: "Launcher Log"
      }
    };
    
    // Show notification
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      
      // Add show class to trigger animation
      setTimeout(() => {
        notification.classList.add('show');
      }, 10);
      
      // Hide after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
    
    // Show/hide loading overlay
    function toggleLoading(show) {
      const overlay = document.getElementById('loadingOverlay');
      if (show) {
        overlay.classList.add('show');
      } else {
        overlay.classList.remove('show');
      }
    }
    
    // Show/hide modal
    function toggleModal(show) {
      const modal = document.getElementById('logModal');
      if (show) {
        modal.classList.add('show');
      } else {
        modal.classList.remove('show');
      }
    }
    
    // Update UI language
    function updateLanguage(lang) {
      const t = translations[lang];
      
      // Update text elements
      document.getElementById('settingsTitle').textContent = t.settings;
      document.getElementById('ramTitle').textContent = t.ram;
      document.getElementById('ramSubtitle').textContent = t.ramDesc;
      document.getElementById('consoleTitle').textContent = t.console;
      document.getElementById('consoleSubtitle').textContent = t.consoleDesc;
      document.getElementById('languageTitle').textContent = t.language;
      document.getElementById('languageSubtitle').textContent = t.languageDesc;
      
      if (document.getElementById('adminSettingsItem').style.display === 'flex') {
        document.getElementById('adminTitle').textContent = t.admin;
        document.getElementById('adminSubtitle').textContent = t.adminDesc;
      }
      
      // Update button texts
      document.getElementById('showLogButton').textContent = t.showLog;
      document.getElementById('logoutButton').textContent = t.logout;
      document.getElementById('backButton').textContent = t.backToLauncher;
      document.getElementById('logModalTitle').textContent = t.logModalTitle;
      
      // Save language preference
      localStorage.setItem('language', lang);
    }
    
    // Initialize
    window.addEventListener("load", function() {
      // Load language preference
      const savedLanguage = localStorage.getItem('language') || 'de';
      document.getElementById('languageSelect').value = savedLanguage;
      updateLanguage(savedLanguage);
      
      // Set up language change listener
      document.getElementById('languageSelect').addEventListener('change', function() {
        updateLanguage(this.value);
      });
      
      // Fetch settings info
      toggleLoading(true);
      fetch("/settings/info")
        .then(response => response.json())
        .then(data => {
          document.getElementById("ramInfo").textContent = data.selectedRam;
          document.getElementById("consoleCheckbox").checked = data.loggingEnabled;
          
          if (data.isAdmin) {
            document.getElementById("adminSettingsItem").style.display = "flex";
            // Update admin text based on language
            const lang = document.getElementById('languageSelect').value;
            document.getElementById('adminTitle').textContent = translations[lang].admin;
            document.getElementById('adminSubtitle').textContent = translations[lang].adminDesc;
          }
          
          toggleLoading(false);
        })
        .catch(error => {
          console.error("Fehler beim Laden der Einstellungen:", error);
          showNotification("Einstellungen konnten nicht geladen werden", "error");
          toggleLoading(false);
        });
    });

    // Console checkbox
    document.getElementById("consoleCheckbox").addEventListener("change", function() {
      toggleLoading(true);
      
      fetch("/toggleConsole", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({enabled: this.checked})
      })
      .then(response => response.json())
      .then(data => {
        const lang = document.getElementById('languageSelect').value;
        showNotification(
          data.loggingEnabled ? 
            (lang === 'de' ? "Konsole aktiviert" : "Console enabled") : 
            (lang === 'de' ? "Konsole deaktiviert" : "Console disabled")
        );
        toggleLoading(false);
      })
      .catch(error => {
        console.error("Fehler beim Umschalten der Konsole:", error);
        const lang = document.getElementById('languageSelect').value;
        showNotification(
          lang === 'de' ? 
            "Einstellung konnte nicht gespeichert werden" : 
            "Setting could not be saved", 
          "error"
        );
        toggleLoading(false);
      });
    });

    // Logout button
    document.getElementById("logoutButton").addEventListener("click", function() {
      toggleLoading(true);
      
      fetch("/logout", { method: "POST" })
        .then(response => response.json())
        .then(data => {
          showNotification(data.message);
          
          setTimeout(() => {
            window.location.href = "/";
          }, 1000);
        })
        .catch(error => {
          console.error("Fehler beim Logout:", error);
          const lang = document.getElementById('languageSelect').value;
          showNotification(
            lang === 'de' ? "Logout fehlgeschlagen" : "Logout failed", 
            "error"
          );
          toggleLoading(false);
        });
    });

    document.getElementById("showLogButton").addEventListener("click", function() {
      toggleLoading(true);
      
      fetch("/showLog", { method: "POST" })
        .then(response => response.json())
        .then(data => {
          document.getElementById("logContent").textContent = data.message || 
            (document.getElementById('languageSelect').value === 'de' ? 
              "Keine Logs verfügbar" : "No logs available");
          toggleLoading(false);
          toggleModal(true);
        })
        .catch(error => {
          console.error("Fehler beim Anzeigen des Logs:", error);
          const lang = document.getElementById('languageSelect').value;
          showNotification(
            lang === 'de' ? "Log konnte nicht geladen werden" : "Could not load log", 
            "error"
          );
          toggleLoading(false);
        });
    });
    
    document.getElementById("closeModal").addEventListener("click", function() {
      toggleModal(false);
    });
    
    document.getElementById("logModal").addEventListener("click", function(e) {
      if (e.target === this) {
        toggleModal(false);
      }
    });

    document.getElementById("adminButton").addEventListener("click", function() {
      toggleLoading(true);
      
      fetch("/admin", { method: "POST" })
        .then(response => response.json())
        .then(data => {
          showNotification(data.message);
          toggleLoading(false);
        })
        .catch(error => {
          console.error("Fehler bei der Admin-Anfrage:", error);
          const lang = document.getElementById('languageSelect').value;
          showNotification(
            lang === 'de' ? 
              "Admin-Funktion konnte nicht ausgeführt werden" : 
              "Admin function could not be executed", 
            "error"
          );
          toggleLoading(false);
        });
    });

    document.getElementById("backButton").addEventListener("click", function() {
      document.body.style.transition = "opacity 0.1s ease-in-out";
      document.body.style.opacity = "0";
      
      setTimeout(() => {
        window.location.href = "/";
      }, 100);
    });
  </script>
</body>
</html>